tinymce.PluginManager.add("importcss",function(e){function t(e){var t=tinymce.Env.cacheSuffix;return"string"==typeof e&&(e=e.replace("?"+t,"").replace("&"+t,"")),e}function n(t){var n=e.settings,i=n.skin!==!1&&(n.skin||"lightgray");if(i){var r=n.skin_url;return r=r?e.documentBaseURI.toAbsolute(r):tinymce.baseURL+"/skins/"+i,t===r+"/content"+(e.inline?".inline":"")+".min.css"}return!1}function i(e){return"string"==typeof e?function(t){return t.indexOf(e)!==-1}:e instanceof RegExp?function(t){return e.test(t)}:e}function r(i,r){function o(e,i){var s,l=e.href;if(l=t(l),l&&r(l,i)&&!n(l)){h(e.imports,function(e){o(e,!0)});try{s=e.cssRules||e.rules}catch(e){}h(s,function(e){e.styleSheet?o(e.styleSheet,!0):e.selectorText&&h(e.selectorText.split(","),function(e){a.push(tinymce.trim(e))})})}}var a=[],s={};h(e.contentCSS,function(e){s[e]=!0}),r||(r=function(e,t){return t||s[e]});try{h(i.styleSheets,function(e){o(e)})}finally{}return a}function o(t){var n,i=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(t);if(i){var r=i[1],o=i[2].substr(1).split(".").join(" "),a=tinymce.makeMap("a,img");return i[1]?(n={title:t},e.schema.getTextBlockElements()[r]?n.block=r:e.schema.getBlockElements()[r]||a[r.toLowerCase()]?n.selector=r:n.inline=r):i[2]&&(n={inline:"span",title:t.substr(1),classes:o}),e.settings.importcss_merge_classes!==!1?n.classes=o:n.attributes={"class":o},n}}function a(e,t){return tinymce.util.Tools.grep(e,function(e){return!e.filter||e.filter(t)})}function s(e){return tinymce.util.Tools.map(e,function(e){return tinymce.util.Tools.extend({},e,{original:e,selectors:{},filter:i(e.filter),item:{text:e.title,menu:[]}})})}function l(e,t){return null===t||e.settings.importcss_exclusive!==!1}function c(t,n,i){return!(l(e,n)?t in i:t in n.selectors)}function u(t,n,i){l(e,n)?i[t]=!0:n.selectors[t]=!0}function d(t,n,i){var r,a=e.settings;return r=i&&i.selector_converter?i.selector_converter:a.importcss_selector_converter?a.importcss_selector_converter:o,r.call(t,n,i)}var f=this,h=tinymce.each;e.on("renderFormatsMenu",function(t){var n=e.settings,o={},l=i(n.importcss_selector_filter),p=t.control,m=s(n.importcss_groups),g=function(t,n){if(c(t,n,o)){u(t,n,o);var i=d(f,t,n);if(i){var r=i.name||tinymce.DOM.uniqueId();return e.formatter.register(r,i),tinymce.extend({},p.settings.itemDefaults,{text:i.title,format:r})}}return null};e.settings.importcss_append||p.items().remove(),h(r(t.doc||e.getDoc(),i(n.importcss_file_filter)),function(e){if(e.indexOf(".mce-")===-1&&(!l||l(e))){var t=a(m,e);if(t.length>0)tinymce.util.Tools.each(t,function(t){var n=g(e,t);n&&t.item.menu.push(n)});else{var n=g(e,null);n&&p.add(n)}}}),h(m,function(e){e.item.menu.length>0&&p.add(e.item)}),t.control.renderNew()}),f.convertSelectorToFormat=o});